<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>XMLHttpRequest上传文件</title>
    <script type="text/javascript">

        var xhr;
        var arr = ["eyroiuq","S奇动物2.HD1280高清中字韩版.mp4",'ThunderExtensionForChrome'];
        var html;
        function UpladFile() {
            var fileObj = document.getElementById("file").files[0];
            var url =  "/fileUpload";
            var form = new FormData();
            form.append("file", fileObj);
            console.log(fileObj.name);

            xhr = new XMLHttpRequest();
            xhr.open("post", url, true);
            xhr.onload = uploadComplete; //请求完成
            xhr.onerror =  uploadFailed; //请求失败

            xhr.upload.onprogress = progressFunction;
            xhr.upload.onloadstart = function(){
                ot = new Date().getTime();
                oloaded = 0;//设置上传开始时，以上传的文件大小为0
            };

            xhr.send(form); //开始上传，发送form数据

            document.getElementById("name").innerHTML = fileObj.name
            document.getElementById("timer").innerHTML = fileObj.lastModifiedDate
            document.getElementById("size").innerHTML = fileObj.size


        }

        function newFile() {
            alert("确认新建文件夹吗？");


            var table = document.getElementById('t1');

            table.innerHTML = "<input name='txtCompany\" + rowID + \"' id='txtCompany\" + rowID + \"' type='text' class='inputStyle' />";
            var  NewRow  = table.insertRow;
            // var NewCell2 = NewRow.insertCell();
            // table.append('<tr><td>1</td><td>1</td></tr>');
            // table.append
        }

        //上传成功响应
        function uploadComplete(evt) {
            //服务断接收完文件返回的结果

            var data = JSON.parse(evt.target.responseText);
            if(data.success) {
                alert("上传成功！");
            }else{
                alert("上传失败！");
            }

        }
        //上传失败
        function uploadFailed(evt) {
            alert("上传失败！");
        }
        //取消上传
        function cancleUploadFile(){
            xhr.abort();
        }


        function progressFunction(evt) {
            var progressBar = document.getElementById("progressBar");
            var percentageDiv = document.getElementById("percentage");
            if (evt.lengthComputable) {//
                progressBar.max = evt.total;
                progressBar.value = evt.loaded;
                percentageDiv.innerHTML = Math.round(evt.loaded / evt.total * 100) + "%";
            }
            var time = document.getElementById("time");
            var nt = new Date().getTime();
            var pertime = (nt-ot)/1000;
            ot = new Date().getTime();
            var perload = evt.loaded - oloaded;
            oloaded = evt.loaded;

            var speed = perload/pertime;s
            var bspeed = speed;
            var units = 'b/s';
            if(speed/1024>1){
                speed = speed/1024;
                units = 'k/s';
            }
            if(speed/1024>1){
                speed = speed/1024;
                units = 'M/s';
            }
            speed = speed.toFixed(1);
            var resttime = ((evt.total-evt.loaded)/bspeed).toFixed(1);
            time.innerHTML = '，速度：'+speed+units+'，剩余时间：'+resttime+'s';
            if(bspeed==0) time.innerHTML = '上传已取消';
        }




    </script>
    <style>
        ul li{
            list-style: none;
        }
    </style>
</head>
<body>
<progress id="progressBar" value="0" max="100" style="width: 300px;"></progress>
<span id="percentage"></span><span id="time"></span>
<br /><br />
<input type="file" id="file" name="myfile" />
<input type="button" onclick="UpladFile()" value="上传" />
<input type="button" onclick="cancleUploadFile()" value="取消" />
<input type="button" onclick="newFile()" size="100" value="新建文件夹" />

<div>
    <h4>文件列表</h4>
    <checkbox></checkbox>
    <table border="1" width="100%" id="t1">
        <tr>
            <th>文件名称:</th>
            <th>创建时间:</th>
            <th>文件大小:</th>
        </tr>
        <tr >

            <td width="0" style="width: 0px" id = "name">  <input type="text" disabled="disabled" th:value="${test}" /></td>
            <td width="0" id = "timer" >  <input type="text" disabled="disabled" th:value="${test}" /></td>
            <td width="0" id = "size">  <input type="text" disabled="disabled" th:value="${test}" /></td>
        </tr>
    </table>


    <!--<ul>-->
        <!--<li><span>文件名：</span><span id="name"></span></li>-->
        <!--<li><span>创建时间：</span><span id='timer'></span></li>-->
        <!--<li><span>文件大小：</span><span id="size"></span></li>-->
    <!--</ul>-->
    <!-- <div id=“fileList”></div> -->
</div>

</body>
</html>